[{"filePath":"C:\\Users\\Jashon\\OneDrive\\Documents\\GitHub\\fpk-learner-v1\\src\\scorm\\ingest\\manifest-parser.ts","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":57,"column":18,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":57,"endColumn":21,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1337,1340],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1337,1340],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":59,"column":14,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":59,"endColumn":17,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1363,1366],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1363,1366],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":126,"column":50,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":126,"endColumn":53,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[3428,3431],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[3428,3431],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":132,"column":97,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":132,"endColumn":100,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[3768,3771],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[3768,3771],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":150,"column":28,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":150,"endColumn":31,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[4615,4618],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[4615,4618],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":151,"column":24,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":151,"endColumn":27,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[4674,4677],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[4674,4677],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":151,"column":72,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":151,"endColumn":75,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[4722,4725],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[4722,4725],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":151,"column":107,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":151,"endColumn":110,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[4757,4760],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[4757,4760],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":151,"column":124,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":151,"endColumn":127,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[4774,4777],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[4774,4777],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":151,"column":147,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":151,"endColumn":150,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[4797,4800],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[4797,4800],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":174,"column":42,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":174,"endColumn":45,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[5682,5685],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[5682,5685],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":186,"column":38,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":186,"endColumn":41,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[6087,6090],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[6087,6090],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":196,"column":42,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":196,"endColumn":45,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[6438,6441],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[6438,6441],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":218,"column":40,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":218,"endColumn":43,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[7175,7178],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[7175,7178],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":223,"column":31,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":223,"endColumn":34,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[7319,7322],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[7319,7322],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":238,"column":29,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":238,"endColumn":32,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[7986,7989],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[7986,7989],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":255,"column":28,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":255,"endColumn":31,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[8947,8950],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[8947,8950],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":257,"column":55,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":257,"endColumn":58,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[9031,9034],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[9031,9034],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":257,"column":90,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":257,"endColumn":93,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[9066,9069],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[9066,9069],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":257,"column":125,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":257,"endColumn":128,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[9101,9104],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[9101,9104],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":259,"column":37,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":259,"endColumn":40,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[9160,9163],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[9160,9163],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":323,"column":38,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":323,"endColumn":41,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[11402,11405],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[11402,11405],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":357,"column":27,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":357,"endColumn":30,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[12646,12649],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[12646,12649],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":359,"column":37,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":359,"endColumn":40,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[12741,12744],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[12741,12744],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":363,"column":34,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":363,"endColumn":37,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[12893,12896],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[12893,12896],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":374,"column":26,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":374,"endColumn":29,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[13264,13267],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[13264,13267],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":26,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { XMLParser } from 'fast-xml-parser';\r\n\r\nexport interface ManifestResource {\r\n  identifier: string;\r\n  type: string;\r\n  href: string;\r\n  scormType?: string;\r\n  adlcpScormType?: string;\r\n  metadata?: unknown;\r\n}\r\n\r\nexport interface ManifestItem {\r\n  identifier: string;\r\n  title: string;\r\n  identifierref?: string;\r\n  isVisible?: boolean;\r\n  parameters?: string;\r\n  masteryScore?: number;\r\n  prerequisites?: string[];\r\n  children?: ManifestItem[];\r\n  resourceHref?: string;\r\n  completionThreshold?: number;\r\n  timeLimitAction?: string;\r\n  dataFromLMS?: string;\r\n  sequencing?: unknown;\r\n}\r\n\r\nexport interface ManifestOrganization {\r\n  identifier: string;\r\n  title: string;\r\n  structure?: string;\r\n  items: ManifestItem[];\r\n  objectives?: unknown[];\r\n  sequencing?: unknown;\r\n}\r\n\r\nexport interface ParsedManifest {\r\n  version: string;\r\n  standard: 'SCORM 1.2' | 'SCORM 2004';\r\n  identifier: string;\r\n  title: string;\r\n  description?: string;\r\n  organizations: ManifestOrganization[];\r\n  resources: ManifestResource[];\r\n  scos: Array<{\r\n    id: string;\r\n    identifier: string;\r\n    title: string;\r\n    launch_href: string;\r\n    parameters?: string;\r\n    mastery_score?: number;\r\n    prerequisites?: string[];\r\n    seq_order: number;\r\n    resourceType?: string;\r\n    scormType?: string;\r\n    isLaunchable: boolean;\r\n    sequencing?: any;\r\n  }>;\r\n  metadata?: any;\r\n  defaultOrganization?: string;\r\n  schemaLocation?: string;\r\n  validation: {\r\n    isValid: boolean;\r\n    errors: string[];\r\n    warnings: string[];\r\n  };\r\n}\r\n\r\nexport class ScormManifestParser {\r\n  private xmlParser: XMLParser;\r\n\r\n  constructor() {\r\n    this.xmlParser = new XMLParser({\r\n      ignoreAttributes: false,\r\n      attributeNamePrefix: '@',\r\n      textNodeName: '#text',\r\n      parseAttributeValue: true,\r\n      trimValues: true,\r\n      alwaysCreateTextNode: false,\r\n      processEntities: true,\r\n      htmlEntities: true\r\n    });\r\n  }\r\n\r\n  public parseManifest(xmlContent: string): ParsedManifest {\r\n    try {\r\n      const parsedXml = this.xmlParser.parse(xmlContent);\r\n      const manifest = (parsedXml as Record<string, unknown>).manifest || (parsedXml as Record<string, unknown>)['imscp:manifest'];\r\n\r\n      if (!manifest) {\r\n        throw new Error('No manifest element found in XML');\r\n      }\r\n\r\n      const validation = this.validateManifest(manifest);\r\n      const standard = this.detectStandard(manifest);\r\n      const version = this.extractVersion(manifest, standard);\r\n\r\n      // Extract basic manifest info\r\n      const m = manifest as Record<string, unknown>;\r\n      const identifier = (m['@identifier'] as string) || 'unknown';\r\n      const title = this.extractTitle(manifest) || 'Untitled Package';\r\n      const description = this.extractDescription(manifest);\r\n\r\n      // Parse organizations\r\n      const organizations = this.parseOrganizations(m.organizations, standard);\r\n      \r\n      // Parse resources\r\n      const resources = this.parseResources(m.resources);\r\n      \r\n      // Extract SCOs by matching items with resources\r\n      const scos = this.extractScos(organizations, resources, standard);\r\n\r\n      // Extract metadata\r\n      const metadata = this.extractMetadata(manifest);\r\n\r\n      return {\r\n        version,\r\n        standard,\r\n        identifier,\r\n        title,\r\n        description,\r\n        organizations,\r\n        resources,\r\n        scos,\r\n        metadata,\r\n        defaultOrganization: (m.organizations as any)?.['@default'] || organizations[0]?.identifier,\r\n        schemaLocation: (m['@schemaLocation'] as string) || (m['@xsi:schemaLocation'] as string),\r\n        validation\r\n      };\r\n    } catch (error: unknown) {\r\n      // Narrow error safely\r\n      const msg = (error && typeof error === 'object' && 'message' in error) ? String((error as any).message) : String(error);\r\n      console.error('Manifest parsing error:', msg);\r\n      throw new Error(`Failed to parse manifest: ${msg}`);\r\n    }\r\n  }\r\n\r\n  private detectStandard(manifest: unknown): 'SCORM 1.2' | 'SCORM 2004' {\r\n    if (!manifest || typeof manifest !== 'object') return 'SCORM 1.2';\r\n    const m = manifest as Record<string, unknown>;\r\n    // Check namespaces and schema locations\r\n    const xmlNamespaces = Object.keys(m).filter(key => key.startsWith('@xmlns'));\r\n    const schemaLocation = (m['@schemaLocation'] as string) || (m['@xsi:schemaLocation'] as string) || '';\r\n\r\n    // SCORM 2004 indicators\r\n    if (\r\n      xmlNamespaces.some(ns => typeof m[ns] === 'string' && String(m[ns]).includes('imsss')) ||\r\n      schemaLocation.includes('imsss') ||\r\n      schemaLocation.includes('2004') ||\r\n      ((m.organizations as any)?.organization?.sequencing) ||\r\n      ((m.resources as any)?.resource && Array.isArray((m.resources as any).resource) && ((m.resources as any).resource as any[]).some(r => (r as any)['@adlcp:scormType']))\r\n    ) {\r\n      return 'SCORM 2004';\r\n    }\r\n\r\n    // SCORM 1.2 indicators or default\r\n    return 'SCORM 1.2';\r\n  }\r\n\r\n  private extractVersion(manifest: unknown, standard: 'SCORM 1.2' | 'SCORM 2004'): string {\r\n    const m = manifest as Record<string, unknown>;\r\n    if (standard === 'SCORM 2004') {\r\n      const schemaLocation = (m['@schemaLocation'] as string) || (m['@xsi:schemaLocation'] as string) || '';\r\n      if (schemaLocation.includes('2004_4th')) return '2004 4th Edition';\r\n      if (schemaLocation.includes('2004_3rd')) return '2004 3rd Edition';\r\n      if (schemaLocation.includes('2004')) return '2004';\r\n    }\r\n    \r\n    return (m['@version'] as string) || (standard === 'SCORM 1.2' ? '1.2' : '2004');\r\n  }\r\n\r\n  private extractTitle(manifest: unknown): string {\r\n    // Try multiple paths for title\r\n    const m = manifest as Record<string, any>;\r\n    const metadata = m.metadata;\r\n    if (metadata?.lom?.general?.title) {\r\n      const title = metadata.lom.general.title;\r\n      return title.langstring?.[\"#text\"] || title.langstring || title[\"#text\"] || title;\r\n    }\r\n    \r\n    if (metadata?.title) {\r\n      return metadata.title[\"#text\"] || metadata.title;\r\n    }\r\n\r\n    // Fallback to organization title\r\n    const orgs = (m.organizations as any)?.organization;\r\n    if (orgs) {\r\n      const firstOrg = Array.isArray(orgs) ? orgs[0] : orgs;\r\n      return firstOrg?.title?.[\"#text\"] || firstOrg?.title || firstOrg?.[\"@title\"];\r\n    }\r\n\r\n    return 'Untitled SCORM Package';\r\n  }\r\n\r\n  private extractDescription(manifest: unknown): string | undefined {\r\n    const m = manifest as Record<string, any>;\r\n    const metadata = m.metadata;\r\n    if (metadata?.lom?.general?.description) {\r\n      const desc = metadata.lom.general.description;\r\n      return desc.langstring?.[\"#text\"] || desc.langstring || desc[\"#text\"] || desc;\r\n    }\r\n    \r\n    if (metadata?.description) {\r\n      return metadata.description[\"#text\"] || metadata.description;\r\n    }\r\n    \r\n    return undefined;\r\n  }\r\n\r\n  private extractMetadata(manifest: unknown): unknown {\r\n    const m = manifest as Record<string, unknown>;\r\n    return m.metadata || {};\r\n  }\r\n\r\n  private parseOrganizations(organizationsNode: unknown, standard: 'SCORM 1.2' | 'SCORM 2004'): ManifestOrganization[] {\r\n    if (!organizationsNode) return [];\r\n\r\n    const orgs = (organizationsNode as any).organization;\r\n    if (!orgs) return [];\r\n\r\n    const orgArray = Array.isArray(orgs) ? orgs : [orgs];\r\n    \r\n    return orgArray.map((org: any, index: number) => ({\r\n      identifier: org['@identifier'] || `org_${index}`,\r\n      title: org.title?.[\"#text\"] || org.title || org[\"@title\"] || `Organization ${index + 1}`,\r\n      structure: org['@structure'] || 'hierarchical',\r\n      items: this.parseItems(org.item, standard),\r\n      objectives: org.objectives || [],\r\n      sequencing: standard === 'SCORM 2004' ? org.sequencing : undefined\r\n    }));\r\n  }\r\n\r\n  private parseItems(itemsNode: unknown, standard: 'SCORM 1.2' | 'SCORM 2004', level = 0): ManifestItem[] {\r\n    if (!itemsNode) return [];\r\n\r\n    const items = Array.isArray(itemsNode) ? itemsNode : [itemsNode];\r\n    \r\n    return items.map((item: any, index: number) => ({\r\n      identifier: item['@identifier'] || `item_${level}_${index}`,\r\n      title: item.title?.[\"#text\"] || item.title || item[\"@title\"] || `Item ${index + 1}`,\r\n      identifierref: item['@identifierref'],\r\n      isVisible: item['@isvisible'] !== 'false', // Default to true\r\n      parameters: item['@parameters'],\r\n      masteryScore: item.masteryScore ? parseFloat(item.masteryScore) : undefined,\r\n      prerequisites: item.prerequisites?.split(',').map((p: string) => p.trim()) || [],\r\n      children: this.parseItems(item.item, standard, level + 1),\r\n      sequencing: standard === 'SCORM 2004' ? item.sequencing : undefined,\r\n      completionThreshold: item.completionThreshold ? parseFloat(item.completionThreshold) : undefined,\r\n      timeLimitAction: item.timeLimitAction,\r\n      dataFromLMS: item.dataFromLMS\r\n    }));\r\n  }\r\n\r\n  private parseResources(resourcesNode: unknown): ManifestResource[] {\r\n    if (!(resourcesNode as any)?.resource) return [];\r\n\r\n    const resources = Array.isArray((resourcesNode as any).resource) ? (resourcesNode as any).resource : [(resourcesNode as any).resource];\r\n    \r\n    return resources.map((resource: any) => ({\r\n      identifier: resource['@identifier'] || '',\r\n      type: resource['@type'] || 'webcontent',\r\n      href: resource['@href'] || resource['@xml:base'] || '',\r\n      scormType: resource['@scormtype'] || resource['@adlcp:scormType'],\r\n      adlcpScormType: resource['@adlcp:scormType'],\r\n      metadata: resource.metadata\r\n    }));\r\n  }\r\n\r\n  private extractScos(\r\n    organizations: ManifestOrganization[], \r\n    resources: ManifestResource[], \r\n    standard: 'SCORM 1.2' | 'SCORM 2004'\r\n  ): ParsedManifest['scos'] {\r\n    const scos: ParsedManifest['scos'] = [];\r\n    let seqOrder = 1;\r\n\r\n    const processItems = (items: ManifestItem[], orgId: string) => {\r\n      items.forEach((item) => {\r\n        if (item.identifierref) {\r\n          const resource = resources.find(r => r.identifier === item.identifierref);\r\n          if (resource) {\r\n            const isLaunchable = this.isLaunchableResource(resource, standard);\r\n            \r\n            scos.push({\r\n              id: `${orgId}_${item.identifier}`,\r\n              identifier: item.identifier,\r\n              title: item.title,\r\n              launch_href: resource.href,\r\n              parameters: item.parameters,\r\n              mastery_score: item.masteryScore,\r\n              prerequisites: item.prerequisites || [],\r\n              seq_order: seqOrder++,\r\n              resourceType: resource.type,\r\n              scormType: resource.scormType || resource.adlcpScormType,\r\n              isLaunchable,\r\n              sequencing: item.sequencing\r\n            });\r\n          }\r\n        }\r\n        \r\n        // Process child items recursively\r\n        if (item.children && item.children.length > 0) {\r\n          processItems(item.children, orgId);\r\n        }\r\n      });\r\n    };\r\n\r\n    organizations.forEach(org => {\r\n      processItems(org.items, org.identifier);\r\n    });\r\n\r\n    return scos;\r\n  }\r\n\r\n  private isLaunchableResource(resource: ManifestResource, standard: 'SCORM 1.2' | 'SCORM 2004'): boolean {\r\n    if (standard === 'SCORM 1.2') {\r\n      return resource.scormType === 'sco' || resource.type === 'webcontent';\r\n    } else {\r\n      return resource.adlcpScormType === 'sco' || resource.scormType === 'sco';\r\n    }\r\n  }\r\n\r\n  private validateManifest(manifest: any): { isValid: boolean; errors: string[]; warnings: string[] } {\r\n    const errors: string[] = [];\r\n    const warnings: string[] = [];\r\n\r\n    // Basic structure validation\r\n    if (!manifest['@identifier']) {\r\n      errors.push('Manifest missing required identifier attribute');\r\n    }\r\n\r\n    if (!manifest.organizations) {\r\n      errors.push('Manifest missing organizations element');\r\n    }\r\n\r\n    if (!manifest.resources) {\r\n      errors.push('Manifest missing resources element');\r\n    }\r\n\r\n    // Organizations validation\r\n    if (manifest.organizations && !manifest.organizations.organization) {\r\n      errors.push('Organizations element contains no organization');\r\n    }\r\n\r\n    // Resources validation\r\n    if (manifest.resources && !manifest.resources.resource) {\r\n      warnings.push('Resources element contains no resource');\r\n    }\r\n\r\n    // Check for broken references\r\n    if (manifest.organizations?.organization) {\r\n      const orgs = Array.isArray(manifest.organizations.organization) ? \r\n        manifest.organizations.organization : [manifest.organizations.organization];\r\n      \r\n      const resources = manifest.resources?.resource || [];\r\n      const resourceIds = Array.isArray(resources) ? \r\n        resources.map((r: any) => r['@identifier']) : [resources['@identifier']];\r\n\r\n      const checkItemRefs = (items: any[]) => {\r\n        if (!items) return;\r\n        const itemArray = Array.isArray(items) ? items : [items];\r\n        \r\n        itemArray.forEach((item: any) => {\r\n          if (item['@identifierref'] && !resourceIds.includes(item['@identifierref'])) {\r\n            errors.push(`Item '${item['@identifier']}' references unknown resource '${item['@identifierref']}'`);\r\n          }\r\n          \r\n          if (item.item) {\r\n            checkItemRefs(item.item);\r\n          }\r\n        });\r\n      };\r\n\r\n      orgs.forEach((org: any) => {\r\n        if (org.item) {\r\n          checkItemRefs(org.item);\r\n        }\r\n      });\r\n    }\r\n\r\n    return {\r\n      isValid: errors.length === 0,\r\n      errors,\r\n      warnings\r\n    };\r\n  }\r\n}\r\n\r\n// Export singleton instance\r\nexport const manifestParser = new ScormManifestParser();\r\n\r\n// Convenience function\r\nexport function parseScormManifest(xmlContent: string): ParsedManifest {\r\n  return manifestParser.parseManifest(xmlContent);\r\n}","usedDeprecatedRules":[]}]